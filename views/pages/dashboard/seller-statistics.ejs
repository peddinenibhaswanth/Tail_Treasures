<div class="container py-5">
    <div class="row">
      <div class="col-12">
        <div class="d-flex justify-content-between align-items-center mb-4">
          <h2><i class="fas fa-chart-pie me-2"></i>Sales Statistics</h2>
          <div>
            <a href="/dashboard/sales" class="btn btn-outline-primary me-2">
              <i class="fas fa-list me-1"></i> View All Sales
            </a>
            <a href="/products/new" class="btn btn-primary">
              <i class="fas fa-plus me-1"></i> Add New Product
            </a>
          </div>
        </div>
  
        <!-- Summary Cards -->
        <div class="row mb-4">
          <div class="col-md-3">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6 class="text-muted mb-1">Total Sales</h6>
                    <h3 class="mb-0">$<%= stats.totalSales.toFixed(2) %></h3>
                  </div>
                  <div class="bg-light rounded-circle p-3">
                    <i class="fas fa-dollar-sign text-primary fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6 class="text-muted mb-1">Total Orders</h6>
                    <h3 class="mb-0"><%= stats.totalOrders %></h3>
                  </div>
                  <div class="bg-light rounded-circle p-3">
                    <i class="fas fa-shopping-bag text-success fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6 class="text-muted mb-1">Items Sold</h6>
                    <h3 class="mb-0"><%= stats.totalItems %></h3>
                  </div>
                  <div class="bg-light rounded-circle p-3">
                    <i class="fas fa-box text-info fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-3">
            <div class="card shadow-sm h-100">
              <div class="card-body">
                <div class="d-flex justify-content-between align-items-center">
                  <div>
                    <h6 class="text-muted mb-1">Low Stock Items</h6>
                    <h3 class="mb-0"><%= stats.inventory.lowStock %></h3>
                  </div>
                  <div class="bg-light rounded-circle p-3">
                    <i class="fas fa-exclamation-triangle text-warning fa-2x"></i>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
  
        <!-- Charts Row -->
        <div class="row mb-4">
          <div class="col-md-8">
            <div class="card shadow-sm h-100">
              <div class="card-header bg-white">
                <h5 class="mb-0">Monthly Sales</h5>
              </div>
              <div class="card-body">
                <canvas id="monthlySalesChart" height="300"></canvas>
              </div>
            </div>
          </div>
          <div class="col-md-4">
            <div class="card shadow-sm h-100">
              <div class="card-header bg-white">
                <h5 class="mb-0">Inventory Status</h5>
              </div>
              <div class="card-body">
                <canvas id="inventoryChart" height="300"></canvas>
              </div>
            </div>
          </div>
        </div>
  
        <!-- Top Products -->
        <div class="card shadow-sm mb-4">
          <div class="card-header bg-white">
            <h5 class="mb-0">Top Selling Products</h5>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="bg-light">
                  <tr>
                    <th>Product</th>
                    <th>Units Sold</th>
                    <th>Revenue</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (stats.topProducts && stats.topProducts.length > 0) { %>
                    <% stats.topProducts.forEach(product => { %>
                      <tr>
                        <td>
                          <div class="d-flex align-items-center">
                            <% if (product.image) { %>
                              <img src="<%= product.image %>" alt="<%= product.name %>" class="img-thumbnail me-3" style="width: 50px; height: 50px; object-fit: cover;">
                            <% } else { %>
                              <div class="bg-light me-3" style="width: 50px; height: 50px; display: flex; align-items: center; justify-content: center;">
                                <i class="fas fa-box text-muted"></i>
                              </div>
                            <% } %>
                            <div>
                              <h6 class="mb-0"><%= product.name %></h6>
                            </div>
                          </div>
                        </td>
                        <td><%= product.sold %></td>
                        <td>$<%= product.revenue.toFixed(2) %></td>
                        <td>
                          <a href="/products/<%= product._id %>" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye"></i> View
                          </a>
                          <a href="/products/<%= product._id %>/edit" class="btn btn-sm btn-outline-secondary">
                            <i class="fas fa-edit"></i> Edit
                          </a>
                        </td>
                      </tr>
                    <% }); %>
                  <% } else { %>
                    <tr>
                      <td colspan="4" class="text-center py-4">
                        <p class="text-muted mb-0">No products sold yet.</p>
                      </td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
  
        <!-- Recent Orders -->
        <div class="card shadow-sm">
          <div class="card-header bg-white">
            <h5 class="mb-0">Recent Orders</h5>
          </div>
          <div class="card-body p-0">
            <div class="table-responsive">
              <table class="table table-hover mb-0">
                <thead class="bg-light">
                  <tr>
                    <th>Order #</th>
                    <th>Date</th>
                    <th>Customer</th>
                    <th>Status</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <% if (stats.recentOrders && stats.recentOrders.length > 0) { %>
                    <% stats.recentOrders.forEach(order => { %>
                      <tr>
                        <td class="fw-bold">#<%= order._id.toString().slice(-6).toUpperCase() %></td>
                        <td><%= new Date(order.createdAt).toLocaleDateString() %></td>
                        <td><%= order.customer ? order.customer.name : 'Customer' %></td>
                        <td>
                          <% if (order.status === 'placed') { %>
                            <span class="badge bg-primary">Placed</span>
                          <% } else if (order.status === 'processing') { %>
                            <span class="badge bg-info">Processing</span>
                          <% } else if (order.status === 'shipped') { %>
                            <span class="badge bg-warning text-dark">Shipped</span>
                          <% } else if (order.status === 'delivered') { %>
                            <span class="badge bg-success">Delivered</span>
                          <% } else if (order.status === 'cancelled') { %>
                            <span class="badge bg-danger">Cancelled</span>
                          <% } %>
                        </td>
                        <td>
                          <a href="/dashboard/sales/<%= order._id %>" class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye"></i> View
                          </a>
                        </td>
                      </tr>
                    <% }); %>
                  <% } else { %>
                    <tr>
                      <td colspan="5" class="text-center py-4">
                        <p class="text-muted mb-0">No recent orders.</p>
                      </td>
                    </tr>
                  <% } %>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    // Monthly Sales Chart
    const monthlySalesCtx = document.getElementById('monthlySalesChart').getContext('2d');
    const monthlySalesChart = new Chart(monthlySalesCtx, {
      type: 'bar',
      data: {
        labels: <%- JSON.stringify(stats.monthlySales.labels) %>,
        datasets: [{
          label: 'Sales ($)',
          data: <%- JSON.stringify(stats.monthlySales.data) %>,
          backgroundColor: 'rgba(54, 162, 235, 0.5)',
          borderColor: 'rgba(54, 162, 235, 1)',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        scales: {
          y: {
            beginAtZero: true,
            ticks: {
              callback: function(value) {
                return '$' + value;
              }
            }
          }
        }
      }
    });
  
    // Inventory Chart
    const inventoryCtx = document.getElementById('inventoryChart').getContext('2d');
    const inventoryChart = new Chart(inventoryCtx, {
      type: 'doughnut',
      data: {
        labels: ['In Stock', 'Out of Stock', 'Low Stock'],
        datasets: [{
          data: [
            <%= stats.inventory.inStock - stats.inventory.lowStock %>, 
            <%= stats.inventory.outOfStock %>, 
            <%= stats.inventory.lowStock %>
          ],
          backgroundColor: [
            'rgba(75, 192, 192, 0.5)',
            'rgba(255, 99, 132, 0.5)',
            'rgba(255, 205, 86, 0.5)'
          ],
          borderColor: [
            'rgba(75, 192, 192, 1)',
            'rgba(255, 99, 132, 1)',
            'rgba(255, 205, 86, 1)'
          ],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });
  </script>
  